.ORIG x3000
AND R1,R1,#0         ;R1 = row1 rocks
ADD R1,R1,#3
AND R2,R2,#0         ;R2 = row2 rocks
ADD R2,R2,#5
AND R3,R3,#0         ;R3 = row3 rocks          
ADD R3,R3,#8
AND R4,R4,#0         ;R4 = turn
AND R5,R5,#0         ;R5 = validity of input (invalid = 1)
AND R6,R6,#0         ;R6 = check letter
GAME JSR STATUS
JSR INPUT
JSR WIN
BR GAME
STATUS ST R7,SAVER7
LEA R0,ROWA
TRAP x22
ADD R5,R1,#0
BRZ SKIPTOB
LD R0,ROCK
ANOTHER TRAP x21
ADD R5,R5,#-1
BRP ANOTHER
SKIPTOB LD R0,NEWLINE
TRAP x21
LEA R0,ROWB
TRAP x22
ADD R5,R2,#0
BRZ SKIPTOC
LD R0,ROCK
BNOTHER TRAP x21
ADD R5,R5,#-1
BRP BNOTHER
SKIPTOC LD R0,NEWLINE
TRAP x21
LEA R0,ROWC
TRAP x22
ADD R5,R3,#0
BRZ SKIPTOEND
LD R0,ROCK
CNOTHER TRAP x21
ADD R5,R5,#-1
BRP CNOTHER
SKIPTOEND LD R0,NEWLINE
TRAP x21
LD R7,SAVER7
RET
INPUT ST R7,SAVER7
LOOP LEA R0,PLAYER
TRAP x22
ADD R4,R4,#1
AND R6,R4,#1
BRz SECOND
LD R0,ONE
TRAP x21
BR BOTH
SECOND LD R0,TWO
TRAP x21
BOTH LEA R0,PROMPT
TRAP x22
TRAP x20
MONITOR LDI R7,DSR
BRZP MONITOR
STI R0,DDR
LD R6,A
ADD R6,R6,R0
BRNP NOTA
ADD R6,R0,#0
TRAP x20
MONITOR2 LDI R7,DSR
BRZP MONITOR2
STI R0,DDR
ADD R0,R0,#-16
ADD R0,R0,#-16
ADD R0,R0,#-16
BRNZ INVALIDNUM
NOT R0,R0
ADD R0,R0,#1
ADD R6,R0,R1
BRN INVALIDNUM
ADD R1,R1,R0
BR DONE
NOTA LD R6,B
ADD R6,R6,R0
BRNP NOTB
ADD R6,R0,#0
TRAP x20
MONITOR3 LDI R7,DSR
BRZP MONITOR3
STI R0,DDR
ADD R0,R0,#-16
ADD R0,R0,#-16
ADD R0,R0,#-16
BRNZ INVALIDNUM
NOT R0,R0
ADD R0,R0,#1
ADD R6,R0,R2
BRN INVALIDNUM
ADD R2,R2,R0
BR DONE
NOTB LD R6,C
ADD R6,R6,R0
BRNP INVALID
ADD R6,R0,#0
TRAP x20
MONITOR4 LDI R7,DSR
BRZP MONITOR4
STI R0,DDR
ADD R0,R0,#-16
ADD R0,R0,#-16
ADD R0,R0,#-16
BRNZ INVALIDNUM
NOT R0,R0
ADD R0,R0,#1
ADD R6,R0,R3
BRN INVALIDNUM
ADD R3,R3,R0
BR DONE
INVALID ADD R5,R5,#1
TRAP x20
MONITOR5 LDI R7,DSR
BRZP MONITOR5
STI R0,DDR
INVALIDNUM ADD R5,R5,#1
DONE ADD R5,R5,#0
BRZ VALID
LD R0,NEWLINE
TRAP x21
LEA R0,ERROR
TRAP x22
LD R0,NEWLINE
TRAP x21
ADD R4,R4,#-1
AND R5,R5,#0
BR LOOP
VALID LD R0,NEWLINE
TRAP x21
LD R0,NEWLINE
TRAP x21
LD R7,SAVER7
RET
WIN ST R7,SAVER7
AND R5,R5,#0
ADD R5,R1,R2
ADD R5,R5,R3
BRZ WINNER
LD R7,SAVER7
RET
WINNER LEA R0,PLAYER
TRAP x22
AND R4,R4,#1
BRZ FIRST
LD R0,TWO
TRAP x21
LEA R0,WON
TRAP x22
TRAP x25
FIRST LD R0,ONE
TRAP x21
LEA R0,WON
TRAP x22
TRAP x25
A .FILL #-65
B .FILL #-66
C .FILL #-67
PLAYER .STRINGZ "Player "
PROMPT .STRINGZ ", choose a row and number of rocks: "
ERROR .STRINGZ "Invalid move. Try again."
WON .STRINGZ " Wins."
ROWA .STRINGZ "ROW A: "
ROWB .STRINGZ "ROW B: "
ROWC .STRINGZ "ROW C: "
SAVER7 .BLKW 1
NEWLINE .FILL x0A
ONE .FILL x31
TWO .FILL x32
ROCK .FILL x6F
DDR .FILL xFE06
DSR .FILL xFE04
.END